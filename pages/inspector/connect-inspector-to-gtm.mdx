import { Callout } from 'nextra/components';

# Google Tag Manager Source (beta)

<Callout type="info">
The Inspector Google Tag Manager integrations are currently in beta so please reach out to us at support@avo.app or in the chat bubble in the bottom right corner if you have any feedback.
</Callout>


## Send data from Google Tag Manager to Avo Inspector

### Destination Info

* Supports both client side and server side Google Tag Manager  
* Inspector events can be verified using the browser developer console
* Observability can be added to all data layer events using client side GTM in under 90 seconds
* Observability can be added to all Google Analytics events using our server side GTM installation option
* Events detected by Inspector can be added to the Avo tracking plan within the Inspector UI, allowing you to fill a documentation gap on legacy events in seconds


Google Tag Manager (GTM) is a tag management system that allows you to quickly update tags and code snippets on your website, web apps, and apps. Once you deploy the Tag Manager snippet, you can configure (trigger) tags using a web-based user interface without having to alter and deploy additional code. It is common for early stage companies to use Google Tag Manager to take care of dispatching their core analytics events to reduce developer dependencies whenever new events are needed, and as the analytics maturity grow and more accuracy is needed, developers will deploy in-code data layer events, and then GTM tag owners will trigger the analytics service events off the data layer events accordingly. [Learn more about that here](https://www.loom.com/share/22c9e0f1175141efa7a0bdbf51201096). 

**_Reminders:_** 
- The Inspector SDKs are designed with flexibility in mind, so you should always be able to add observability to the source of your pipelines.
- Avo Inspector operates on the environment level, please keep it in mind and create separate tags for development, staging and production data.

### Getting Started
Avo Inspector requires two core steps to add observability. First is initialization of the Inspector. Second is sending events to Inspector. Both steps have installation options available to you to support different configurations. Which ever path you take, your data observability journey starts with creating an Avo source because this is where you create source specific API keys and can get the initialization code. From the Avo Sources UI, click New source and give it a memorable name to describe the data source you are adding observability too. 

**Notes:** 
For our client side GTM importable recipe, the initialization code is already included in a tag, so you would just need to give the Inspector API GTM variable your source specific API key, which you can find in your Avo source Inspector setup. Please note that the Inspector GTM recipe defaults to the 'prod' environment, and this results in a 1 hour lag between tracking and displaying events in Inspector report. If you wish to verify Inspector events are received instantly, adjust the Avo Inspector Init tag by changing the 'prod' value to 'dev' on the inspector.__ENV__ key. If you prefer not to use our client side importable recipe, it is also possible to initialize Inspector via creating your own HTML tag and using the HTML script you can find in the source Inspector setup. If you have occasions where data layer events could fire before GTM loads and you wish you add observability, we'd recommend initializing inspector outside of Google Tag Manager, and perhaps adding our initialization code to the header of the page or using one of our other Inspector SDKs and adding it more native to your codebase. The flexibility here is a feature.

## Inspector Client side GTM integration (beta)

There are two options to install Inspector via Google Tag Manager. You can either import our GTM recipe to add observability to all data layer events, or use our Inspector function to add observability to individual events.

### Importable GTM recipe

To add observability to all data layer events with our importable GTM recipe [in under 90 seconds](https://www.loom.com/share/c659b857d4d947729683bf11691f441e), follow the steps below:
1. [Download our GTM recipe here]()
2. Import the recipe into your GTM container. 
3. Add the source specific Inspector API key. 
4. Publish the container.
5. Visit the Avo Inspector dashboard in one hour to see
6. Consider creating a filtered issues view for the data bugs you care about. [learn more here](https://www.avo.app/docs/inspector/inspector-issues-view).

> **Notes:_** 
If you want to test Inspector is working correctly. Adjust the Avo Inspector Init tag by changing the 'prod' value to 'dev' on the inspector.__ENV__ key. This results in events showing in the Inspector dashboard instantly.

### Inspector Get Schema function

To add observability to single events with our Inspector Get Schema function, create a HTML script tag for each event you want to add observability to. The steps are shown in the screen shot below and make sure to use the same trigger and variables as you are using for the event you're dispatching to your analytics vendor. 

[insert image from our latest blog on GTM]

> **_Notes:_** 
While our importable recipe allows you to add observability to all data layer events in production in under 90 seconds, we are aware that many GTM containers are a hybrid of data layer based triggered tags for analytics events, and GTM native ones (think source selectors). If your GTM analytics implementation uses a hybrid trigger setup, to increase Inspector coverage, you could use our recipe to catch all data layer events with a single tag, and then single event Inspector Tags for native GTM trigger based events. If you wanted a single tag that catches both data layer and native GTM triggered events sent Google Analytics 4, for example, ask your developer to code a tag that detects all analytics track calls via the GA4 end point calls, parses the payload, and loops through the properties to then forward the track on to Inspector. We're currently investigating this for our new recipe. 

## Inspector Server side GTM integration (beta)

This tag is designed to be used with the server side Google Tag Manager, learn more [here](https://developers.google.com/tag-platform/tag-manager/server-side/overview)

### Import Avo Inspector GTM tag template

1. Download the tag template file from [GitHub](https://github.com/avohq/gtm-server-avo-inspector-template/blob/master/template.tpl), there is a download button in the top right of the file content area

![Download button in the GitHub interface](/images/server-gtm-download.png)

2. Navigate to the Templates tab in your server side GTM console

![Templates option in the side menu](/images/server-gtm-templates.png)

3. In the Tag Templates section, click New

![New button on the templates screen](/images/server-gtm-template-new.png)

4. Click three dots in the top right and choose 'Import' in the drop-down menu

![Dropdown in the templates screen with the import button](/images/server-gtm-import.png)

5. Select the `template.tpl` file you downloaded on step 1

### Create Avo Inspector GTM tag

1. Navigate to the Tags tab in your server side GTM console

![Tags option in the side menu](/images/server-gtm-tags.png)

2. Click New in the top right

![New button on the tags screen](/images/server-gtm-tag-new.png)

3. Click Tag Configuration section and choose Avo Inspector form the options

![Tag configuration tile on the new tag screen](/images/server-gtm-tag-configuration.png)

4. Paste you Avo Inspector key. To get the key open your Avo.app workspace, choose the source you want to connect the Inspector to and navigate to the Inspector Setup tab.

![Navigation to the inspector key in Avo](/images/server-gtm-avo-inspector-setup.png)

5. Choose which environment this tag is reporting from. Inspector distinguish development, staging, and production environments. Production is designed for high data volumes, while development and staging are designed for faster time to feedback in the Inspector dashboard. You'll see your dev and staging events in the Inspector dashboard almost instantly, while the production events can take up to an hour to appear
6. Add a trigger, it's best to analyse all events in Inspector. We suggest to add a trigger that accepts all events, for example with the `.*` regex. Make sure that you are only sending the events from the environment configured on the step 3. Learn more about defining triggers [here](https://support.google.com/tagmanager/topic/7679384)
7. Now all the data sent to this server side GTM will be analysed by Inspector. Learn more about sending data to the server side Tag Manager [here](https://developers.google.com/tag-platform/tag-manager/server-side/send-data)