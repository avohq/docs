# Sending data to Snowplow

## Snowplow tracking interface

Snowplow SDK's tracking interface is a little different from the common event tracking libraries and working with Snowplow through Avo is slightly different too.

The main idea stays the same though, when you initialize the Avo analytics wrapper generated for you, you pass an object with callbacks that will be called by Avo after all the validations are done.

The callback object has the following interface:

```pseudocode
func make(env: AvoEnv)

func trackSelfDescribingEvent(schema: String, data: Dictionary, 
        contexts: List<Dictionary<schema: String, data: Dictionary>>)

func trackPageView(title: String)

func identify(userId: String)

func unidentify()
```

> In the server side Codegen we add extra `userId_` and `anonymousUserId_` parameters to the `trackSelfDescribingEvent` method for the user management, [learn more here.](/reference/avo-codegen/anonymous-user-id#user-identity-in-the-server-side-codegen)

In each callback you would do a specific action, that maps directly to the Snowplow SDK. Code snippets for various programming languages are are available below.

1. `make` - here you would initialize your Snowplow SDK. You can skip this callback (leave empty) if you already have the Snowplow SDK initialized, the parameter will be one of `AvoEnv.Dev`, `AvoEnv.Prod`, `AvoEnv.Staging`.

2. `trackSelfDescribingEvent` - this callback provides you all the data needed to track a self describing event

3. `trackPageView` - this callback is for tracking page views, with the page title as parameter, there is a corresponding method in the Snowplow SDK

4. `identify` - this callback is to assign an id of the current user, which is the call's parameter, in Snowplow it's done by assigning the user id in the Subject config

5. `unidentify` - this callback is for removing current user's identification

## Code snippets

### Kotlin

```kotlin
val avo = AvoImpl(...,
    snowplowDestination = object : AvoSnowplowDestination {
        override fun make(env: AvoEnv) {
            // Optional: You can initialize Snowplow here or leave empty if initialized elsewhere.
            // Your custom Snowplow initialization, that includes the `createTracker` call
            // Snowplow.createTracker(this@MainActivity, "appTracker", "COLLECTOR_URL", HttpMethod.POST)
            // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=android
        }

        override fun trackSelfDescribingEvent(schema: String, data: Map<String, *>, contexts: List<Map<String, Any>>) {
            val eventContent = SelfDescribingJson(schema, data)

            val event = SelfDescribing(eventContent)
            contexts.forEach { customContext ->
                val contextSchema = customContext["schema"]
                val contextData = customContext["data"]
                if (contextSchema is String && contextData is Any) {
                    event.customContexts.add(
                            SelfDescribingJson(contextSchema, contextData)
                    )
                }
            }

            Snowplow.getDefaultTracker()?.track(event)
            // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=android
        }

        override fun trackPageView(title: String) {
            Snowplow.getDefaultTracker()?.track(ScreenView(title))
            // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=android
        }

        override fun identify(userId: String) {
            Snowplow.getDefaultTracker()?.subject?.userId = userId
            // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=android
        }

        override fun unidentify() {
            Snowplow.getDefaultTracker()?.subject?.userId = null
            // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=android
        }
    }
)
```

### Typescript & JavaScript

```typescript
const snowplowDestination = {
  make: function(env: string) {
    // Optional: You can initialize Snowplow here or leave empty if initialized elsewhere.
    // Your custom Snowplow initialization, that includes the `newTracker` call
    // newTracker('sp1', '{{collector_url}}', {  appId: 'my-app-id',  plugins: [ ], });
    // Learn more: https://docs.snowplow.io/docs/sources/web-trackers/
  },
  trackSelfDescribingEvent: (schema: string, data: any, contexts: any[]): void => {
    trackSelfDescribingEvent({
      event: {
        schema: schema,
        data: data
      },
      context: contexts
    });
    // Learn more: https://docs.snowplow.io/docs/sources/web-trackers/custom-tracking-using-schemas/
  },
  trackPageView: (title: string): void => {
    trackPageView(title);
    // Learn more: https://docs.snowplow.io/docs/sources/web-trackers/custom-tracking-using-schemas/
  },
  identify: (userId: string): void => {
    setUserId(userId);
    // Learn more: https://docs.snowplow.io/docs/sources/web-trackers/custom-tracking-using-schemas/
  },
  unidentify: (): void => {
    clearUserData();
    // Learn more: https://docs.snowplow.io/docs/sources/web-trackers/custom-tracking-using-schemas/
  },

};
```

### Swift

```swift
extension SnowplowDestination: AvoSnowplowDestination {
    func make(env: AvoEnv) {
        // Optional: You can initialize Snowplow here or leave empty if initialized elsewhere.
        // Your custom Snowplow initialization, that includes the `createTracker` call
        // Snowplow.createTracker(namespace: "appTracker", endpoint: "COLLECTOR_URL", method: .post)
        // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=ios
    }

    func trackSelfDescribingEvent(schema: String, data: [String: Any], contexts: [[String: Any]]) {  
        let event = SelfDescribing(schema: schema, payload: data)  

        contexts.forEach { context in
            event.contexts.add(
                SelfDescribingJson(schema: context["schema"],
                    andDictionary: context["data"]))
        }

        Snowplow.getDefaultTracker().track(event)
        // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=ios
    }

    func identify(userId: String) {
        Snowplow.getDefaultTracker().subject.setUserId(userId)
        // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=ios
    }

    func unidentify() {
        Snowplow.getDefaultTracker().subject.setUserId(nil)
        // Learn more: https://docs.snowplow.io/docs/sources/mobile-trackers/installation-and-set-up/?platform=ios
    }
}

let avo = Avo(..., snowplowDestination: SnowplowDestination())
```